{%- comment -%}
Enhanced version of your current microdata.liquid file
Replace your existing microdata.liquid with this enhanced version
{%- endcomment -%}

{%- if request.page_type == 'product' -%}
  {%- comment -%}
  Replace the basic product-schema with your comprehensive one
  Save your comprehensive schema template as snippets/enhanced-product-schema.liquid
  {%- endcomment -%}
  {%- render 'product-schema' -%}
{%- elsif request.page_type == 'article' -%}
  {%- comment -%} Render recipe schema for recipe articles {%- endcomment -%}
  {%- render 'recipe-schema' -%}
  
  {%- comment -%} Always include basic blog schema as well {%- endcomment -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": {{ article.title | json }},
    "description": {{ article.excerpt_or_content | strip_html | truncatewords: 25 | json }},
    "datePublished": "{{ article.published_at | date: '%Y-%m-%d' }}",
    "dateModified": "{{ article.updated_at | date: '%Y-%m-%d' }}",
    "author": {
      "@type": "Person",
      "name": "{{ article.user.first_name }} {{ article.user.last_name }}"
    },
    "publisher": {
      "@type": "Organization",
      "name": {{ shop.name | json }}
    },
    {%- if article.image -%}
    "image": [
      {{ article.image | image_url: width: 1200, height: 675 | prepend: 'https:' | json }},
      {{ article.image | image_url: width: 1200, height: 1200 | prepend: 'https:' | json }},
      {{ article.image | image_url: width: 1200, height: 900 | prepend: 'https:' | json }}
    ],
    {%- endif -%}
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "{{ shop.url }}{{ article.url }}"
    },
    "url": "{{ shop.url }}{{ article.url }}"
  }
  </script>
{%- endif -%}

{%- comment -%} Enhanced Breadcrumb Schema {%- endcomment -%}
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "{{ shop.url }}"
      }

      {%- if request.page_type == 'product' -%}
        {%- if collection -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ collection.title | json }},
            "item": "{{ shop.url }}{{ collection.url }}"
          }, {
            "@type": "ListItem",
            "position": 3,
            "name": {{ product.title | json }},
            "item": "{{ shop.url }}{{ product.url }}"
          }
        {%- elsif product.collections.first -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ product.collections.first.title | json }},
            "item": "{{ shop.url }}{{ product.collections.first.url }}"
          }, {
            "@type": "ListItem",
            "position": 3,
            "name": {{ product.title | json }},
            "item": "{{ shop.url }}{{ product.url }}"
          }
        {%- else -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ product.title | json }},
            "item": "{{ shop.url }}{{ product.url }}"
          }
        {%- endif -%}
      {%- elsif request.page_type == 'collection' -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ collection.title | json }},
            "item": "{{ shop.url }}{{ collection.url }}"
          }
      {%- elsif request.page_type == 'blog' -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ blog.title | json }},
            "item": "{{ shop.url }}{{ blog.url }}"
          }
      {%- elsif request.page_type == 'article' -%}
          ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ blog.title | json }},
            "item": "{{ shop.url }}{{ blog.url }}"
          }, {
            "@type": "ListItem",
            "position": 3,
            "name": {{ article.title | json }},
            "item": "{{ shop.url }}{{ article.url }}"
          }
      {%- elsif request.page_type == 'page' -%}
        ,{
            "@type": "ListItem",
            "position": 2,
            "name": {{ page.title | json }},
            "item": "{{ shop.url }}{{ page.url }}"
          }
      {%- endif -%}
    ]
  }
</script>

{%- comment -%} Enhanced Homepage Schema {%- endcomment -%}
{%- if request.page_type == 'index' -%}
  {%- assign potential_action_target = request.origin | append: routes.search_url | append: "?q={search_term_string}" -%}

  <script type="application/ld+json">
  [
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": {{ shop.name | json }},
      "url": {{ shop.url | append: page.url | json }},
      "potentialAction": {
        "@type": "SearchAction",
        "target": {{ potential_action_target | json }},
        "query-input": "required name=search_term_string"
      }
    },
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": {{ shop.name | json }},
      {%- if shop.brand.logo -%}
        "logo": {{ shop.brand.logo | image_url: width: shop.brand.logo.width | prepend: "https:" | json }},
      {%- endif -%}
      {%- if shop.brand.short_description -%}
        "description": {{ shop.brand.short_description | json }},
      {%- endif -%}
      {%- if shop.brand.slogan -%}
        "slogan": {{ shop.brand.slogan | json }},
      {%- endif -%}
      {%- if shop.brand.metafields.social_links.size > 0 -%}
        "sameAs": [
          {%- for social_link in shop.brand.metafields.social_links -%}
            {{- social_link.last.value | json -}}{%- unless forloop.last -%},{%- endunless -%}
          {%- endfor -%}
        ],
      {%- endif -%}
      "url": {{ shop.url | append: page.url | json }}
    }
  ]
  </script>
{%- endif -%}